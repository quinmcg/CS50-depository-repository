<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        div#mp3_player{ width:1000px; height:500px; background:#4d4d4d; padding:5px; margin:0 auto; }
        div#mp3_player > div > audio{  width:1000px; background:#4d4d4d; float:left;  }
        div#mp3_player > canvas{ width:1000px; height:500px; background:#4d4d4d; float:left; }
        div#mp3_playerDown{ width:1000px; height:500px; background:#4d4d4d; padding:5px; margin:0 auto; }
        div#mp3_playerDown > div > audio{  width:1000px; background:#4d4d4d; float:left;  }
        div#mp3_playerDown > canvas{ width:1000px; height:500px; background:#4d4d4d; float:left; }
    </style>
    <link rel="stylesheet" type="text/css" href="./style.css">
    <script>
        function updateSource1(){
            audio.src ="songs/bitbird.mp3";
        }
        function updateSource2(){
            audio.src ="songs/gypsyheart.mp3";
        }
        function updateSource3(){
            audio.src ="songs/theone.mp3";
        }
        var audio = new Audio();
        audio.controls = true;
        audio.loop = true;
        audio.autoplay = true;
        var songInfo;
        if (audio.src === 'https://quinmcg.github.io/songs/theone.mp3'){
            songInfo = '<em>The One - <strong>The Chainsmokers</em></strong>';
        }
        if (audio.src === 'https://quinmcg.github.io/songs/bitbird.mp3'){
            songInfo = '<em>zZz - <strong>DROELOE</strong></em>';
        }
        if (audio.src === 'https://quinmcg.github.io/songs/gyspyheart.mp3'){
            songInfo = '<em>Gypsy Heart - <strong>BUNT.</em></strong>';
        }
        var canvas, ctx, source, context, analyser, fbc_array, bars, bar_x, bar_width, bar_height;
        window.addEventListener("load", initMp3Player, false);
        cloneCanvas(document.getElementById('analyser_render'));
        function initMp3Player(){
            document.getElementById('audio_box').appendChild(audio);
            context = new webkitAudioContext();                                                                     // AudioContext object instance
            analyser = context.createAnalyser();                                                                    // AnalyserNode method
            canvas = document.getElementById('analyser_render');
            ctx = canvas.getContext('2d');
            source = context.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(context.destination);
            frameLooper();
        }
        function frameLooper(){
            window.webkitRequestAnimationFrame(frameLooper);
            fbc_array = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(fbc_array);
            ctx.clearRect(0, 0, canvas.width, canvas.height);                                                       // Clear the canvas
            ctx.fillStyle = '#32acf5';                                                                              // Color of the bars
            bars = 200;
            for (var i = 0; i < bars; i++) {
                bar_x = i * 3;
                bar_width = 2;
                bar_height = -(fbc_array[i] / 2);
                ctx.fillRect(bar_x, canvas.height, bar_width, bar_height);
            }
        }
        function cloneCanvas(oldCanvas) {

            //create a new canvas
            var newCanvas = document.createElement('canvas');
            var context = newCanvas.getContext('2d');

            //set dimensions
            newCanvas.width = oldCanvas.width;
            newCanvas.height = oldCanvas.height;

            //apply the old canvas to the new one
            context.drawImage(oldCanvas, 0, 0);
            context.rotate(20 * Math.PI / 180);
            //return the new canvas
            return newCanvas;
        }
    </script>
    <title>Quin's Audio Visualizer</title>
</head>
<body>

<ul class="nav">
    <div class="logo">
        VISUALIZER
    </div>
    <li> <a href="index.html">Visualizer 1.0</a></li>
    <li> <a href="visualizer2.html">Visualizer 2.0</a></li>
    <li> <a href="about.html">About</a></li>
    <li> <a href="sources.html">Sources</a></li>
    <li> <a href="contact.html">Contact</a></li>
</ul>
<div class="banner">
    <img class="banner-image" src="img/banner2.png"/>
</div>
<div id="mp3_player">
    <div id="audio_box"></div>
    <canvas id="analyser_render"></canvas>
</div>
<div id="mp3_player">
    <div id="audio_box"></div>
    <canvas id="analyser_render_down"></canvas>
</div>
<div class="songName">
    <script>document.querySelector('.songName').innerHTML = songInfo;</script>
</div>
<audio id="audio">
    <source id="musicSource" type="audio/mp3">
    Your browser does not support the audio format.
</audio>
<ul style="list-style: none">
    <li><strong>SONGS</strong>
        <ul>
            <li id="song1" data-value="bitbird.mp3">
                <button onclick="updateSource1();">zZz - <em>DROELOE</em></button>
            </li>
            <li id="song2" data-value="gypsyheart.mp3">
                <button onclick="updateSource2();">Gypsy Heart - <em>BUNT.</em></button>
            </li>
            <li id="song3" data-value="theone.mp3">
                <button onclick="updateSource3();">The One - <em>The Chainsmokers</em></button>
            </li>
        </ul>
    </li>
</ul>
</body>
</html>
